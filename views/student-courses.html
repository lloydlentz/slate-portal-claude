<!-- Student Courses View -->
<!-- Purpose: Display current course registrations for a student -->
<!-- Requires: student-courses Method deployed and active -->
<!-- Parameter: uid (person GUID) - passed via querystring to filter by student -->
<!-- Brand: Macalester College official colors -->

<style>
/* Macalester Brand Colors */
:root {
    --mac-blue: #01426A;
    --mac-orange: #D44420;
    --mac-sky-blue: #72C5E7;
    --mac-gold: #FFB500;
    --mac-green: #658D3C;
    --mac-plum: #8A1B61;
    --mac-red: #C8102E;
    --mac-light-gray: #A5ADAF;
    --mac-dark-gray: #5B6770;
}

.portal-student-courses {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.portal-student-courses h2 {
    margin: 0 0 20px 0;
    color: var(--mac-blue);
    font-size: 1.5rem;
    font-weight: 600;
    border-bottom: 3px solid var(--mac-orange);
    padding-bottom: 10px;
}

.portal-student-courses .courses-loading {
    padding: 40px;
    text-align: center;
    color: var(--mac-dark-gray);
}

.portal-student-courses .courses-error {
    padding: 20px;
    background: #fdeaea;
    border: 1px solid var(--mac-red);
    border-left: 4px solid var(--mac-red);
    border-radius: 4px;
    color: var(--mac-red);
}

.portal-student-courses .courses-empty {
    padding: 40px;
    text-align: center;
    color: var(--mac-dark-gray);
    background: #f5f7f8;
    border-radius: 4px;
    border: 1px dashed var(--mac-light-gray);
}

.portal-student-courses .courses-table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    box-shadow: 0 2px 8px rgba(1, 66, 106, 0.1);
    border-radius: 4px;
    overflow: hidden;
}

.portal-student-courses .courses-table th,
.portal-student-courses .courses-table td {
    padding: 12px 16px;
    text-align: left;
    border-bottom: 1px solid #e8eef2;
}

.portal-student-courses .courses-table th {
    background: var(--mac-blue);
    font-weight: 600;
    color: #fff;
    font-size: 0.875rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.portal-student-courses .courses-table tbody tr:hover {
    background: rgba(114, 197, 231, 0.1);
}

.portal-student-courses .courses-table tbody tr:nth-child(even) {
    background: #f9fbfc;
}

.portal-student-courses .courses-table tbody tr:nth-child(even):hover {
    background: rgba(114, 197, 231, 0.15);
}

.portal-student-courses .courses-table td {
    font-size: 0.9375rem;
    color: #333;
}

.portal-student-courses .course-code {
    font-weight: 600;
    color: var(--mac-blue);
}

.portal-student-courses .course-title {
    color: var(--mac-dark-gray);
}

.portal-student-courses .course-schedule {
    white-space: nowrap;
    color: var(--mac-dark-gray);
}

.portal-student-courses .course-status {
    display: inline-block;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

.portal-student-courses .course-status--registered {
    background: rgba(101, 141, 60, 0.15);
    color: var(--mac-green);
}

.portal-student-courses .course-status--waitlisted {
    background: rgba(255, 181, 0, 0.2);
    color: #b38600;
}

.portal-student-courses .credits-total {
    margin-top: 16px;
    padding: 14px 20px;
    background: var(--mac-blue);
    color: #fff;
    border-radius: 4px;
    font-weight: 600;
    font-size: 1rem;
}

.portal-student-courses .credits-total span {
    color: var(--mac-orange);
    font-size: 1.25rem;
}

/* Responsive */
@media (max-width: 768px) {
    .portal-student-courses .courses-table {
        display: block;
        overflow-x: auto;
    }
}
</style>

<div class="portal-student-courses">
    <h2>My Courses</h2>
    <div id="student-courses-container">
        <div class="courses-loading">Loading courses...</div>
    </div>
</div>

<script>
(function() {
    'use strict';

    // Namespace
    window.SlatePortal = window.SlatePortal || {};

    SlatePortal.StudentCourses = {
        config: {
            endpoint: '?cmd=student-courses',
            containerId: 'student-courses-container'
        },

        init: function() {
            this.container = document.getElementById(this.config.containerId);
            if (this.container) {
                this.loadCourses();
            }
        },

        getUrlParam: function(name) {
            var params = new URLSearchParams(window.location.search);
            return params.get(name);
        },

        loadCourses: function() {
            var self = this;
            var uid = this.getUrlParam('uid');
            var endpoint = this.config.endpoint;

            // uid parameter required to filter by student
            if (!uid) {
                this.container.innerHTML = '<div class="courses-error">Missing required parameter: uid</div>';
                return;
            }

            endpoint += '&uid=' + encodeURIComponent(uid);

            fetch(endpoint)
                .then(function(response) {
                    if (!response.ok) throw new Error('Network error');
                    return response.json();
                })
                .then(function(data) {
                    self.render(data.row || []);
                })
                .catch(function(error) {
                    self.renderError(error.message);
                });
        },

        render: function(courses) {
            if (!courses || courses.length === 0) {
                this.container.innerHTML = '<div class="courses-empty">No courses found.</div>';
                return;
            }

            // Group by student if multiple (for admin view)
            // For student portal, typically just one student
            var html = this.buildTable(courses);
            this.container.innerHTML = html;
        },

        buildTable: function(courses) {
            var totalCredits = 0;

            var html = '<table class="courses-table">';
            html += '<thead><tr>';
            html += '<th>Course</th>';
            html += '<th>Title</th>';
            html += '<th>Schedule</th>';
            html += '<th>Location</th>';
            html += '<th>Instructor</th>';
            html += '<th>Credits</th>';
            html += '<th>Status</th>';
            html += '</tr></thead>';
            html += '<tbody>';

            for (var i = 0; i < courses.length; i++) {
                var c = courses[i];
                var credits = parseFloat(c.credits) || 0;
                totalCredits += credits;

                var statusClass = 'course-status';
                if (c.reg_status && c.reg_status.toLowerCase() === 'registered') {
                    statusClass += ' course-status--registered';
                } else if (c.reg_status && c.reg_status.toLowerCase().indexOf('wait') >= 0) {
                    statusClass += ' course-status--waitlisted';
                }

                html += '<tr>';
                html += '<td class="course-code">' + this.escape(c.course || '') + '</td>';
                html += '<td class="course-title">' + this.escape(c.course_title || '') + '</td>';
                html += '<td class="course-schedule">' + this.escape(c.days || '') + ' ' + this.escape(c.time || '') + '</td>';
                html += '<td>' + this.escape(c.location || '') + '</td>';
                html += '<td>' + this.escape(c.instructor || '') + '</td>';
                html += '<td>' + this.escape(c.credits || '') + '</td>';
                html += '<td><span class="' + statusClass + '">' + this.escape(c.reg_status || '') + '</span></td>';
                html += '</tr>';
            }

            html += '</tbody></table>';
            html += '<div class="credits-total">Total Credits: <span>' + totalCredits + '</span></div>';

            return html;
        },

        renderError: function(message) {
            this.container.innerHTML = '<div class="courses-error">Error loading courses: ' + this.escape(message) + '</div>';
        },

        escape: function(str) {
            var div = document.createElement('div');
            div.textContent = str;
            return div.innerHTML;
        }
    };

    // Initialize when DOM ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            SlatePortal.StudentCourses.init();
        });
    } else {
        SlatePortal.StudentCourses.init();
    }
})();
</script>
